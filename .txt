
    document.addEventListener('DOMContentLoaded', function () {
        const tablesContainer = document.querySelector('.tables-container');
        const reservationForm = document.getElementById('tableReservationForm');
        const selectedTableIdInput = document.getElementById('selectedTableId');
        const reserveButton = document.getElementById('reserveButton');

        // Fetch tables and render them
        function fetchTables() {
            fetch('../api/tableBooking.php')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        tablesContainer.innerHTML = '';
                        data.tables.forEach(table => {
                            const tableDiv = document.createElement('div');
                            tableDiv.className = `table-item ${table.capacity}-seater ${table.status}`;
                            tableDiv.dataset.tableId = table.table_id;
                            tableDiv.dataset.capacity = table.capacity;
                            tableDiv.dataset.location = table.location;
                            tableDiv.style.top = `${table.position_y}px`;
                            tableDiv.style.left = `${table.position_x}px`;

                            tableDiv.innerHTML = `
                                <div class="table-top">
                                    <span class="table-number">${table.table_number}</span>
                                </div>
                                <div class="table-info">
                                    <span>${table.capacity} seats</span>
                                </div>
                            `;

                            if (table.status === 'available') {
                                tableDiv.addEventListener('click', () => selectTable(table));
                            }

                            tablesContainer.appendChild(tableDiv);
                        });
                    } else {
                        alert('Error fetching tables: ' + data.error);
                    }
                });
        }

        // Select a table
        function selectTable(table) {
            selectedTableIdInput.value = table.table_id;
            document.getElementById('displayTableId').textContent = table.table_number;
            document.getElementById('displayTableCapacity').textContent = table.capacity;
            document.getElementById('displayTableLocation').textContent = table.location;

            document.querySelector('.selected-table-info').classList.remove('d-none');
            reserveButton.disabled = false;

            // Highlight selected table
            document.querySelectorAll('.table-item').forEach(item => item.classList.remove('selected'));
            document.querySelector(`[data-table-id="${table.table_id}"]`).classList.add('selected');
        }

        // Handle reservation form submission
        reservationForm.addEventListener('submit', function (e) {
            e.preventDefault();

            const formData = new FormData(reservationForm);
            const data = Object.fromEntries(formData.entries());

            fetch('../api/tableBooking.php', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        alert('Reservation successful!');
                        fetchTables();
                        reservationForm.reset();
                        document.querySelector('.selected-table-info').classList.add('d-none');
                        reserveButton.disabled = true;
                    } else {
                        alert('Error making reservation: ' + data.error);
                    }
                });
        });

        // Initial fetch
        fetchTables();
    });
